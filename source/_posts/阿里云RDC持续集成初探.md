---
title: 阿里云RDC持续集成初探
date: 2017-07-25 18:44:48
tags: 
---
[RDC](https://rdc.aliyun.com)是阿里云最近公测的一个研发协同产品，是从“需求->编码->测试->发布->反馈”端到端的持续交付服务，功能很好很强大，不过这里我们先讲如何使用RDC做持续集成。

​	阿里还有另一个类似的产品-[CRP](https://crp.aliyun.com)，只关注持续集成，不过这个产品发展的非常慢，虽然要比RDC推出的更早，但很多问题都没有人处理，构建过程也是非常的慢，部署偶尔还会出现失败的情况。

## 注册应用

​	创建应用的时候会提示你新建或者关联已有的git项目，

​	先将git地址复制到剪切板，在【项目】->【应用】菜单创建应用，最后需要选择开发模式，**自由模式** 、**分支模式**、**GitFlow模式**，开发模式的介绍点击[这里](https://help.aliyun.com/document_detail/54914.html?spm=5176.doc52241.6.557.gyCagZ)，**分支模式**在代码提交后不能自动触发构建，如果需要hook功能这里需要注意一下，目前公测阶段已经创建好的应用不能更改模式，已经向RDC团队建议允许修改，不知道会在未来的哪个版本可以使用。
   ![资源](/assets/images/rdc/1.png)

​	**注意：**这里还有一个坑，如果你的git项目是关联的，那么必须要有`master`主干，否则注册应用时会报错，这个问题应该很快就会修复。

## 修改release文件

​	注册应用完成后会帮你生成一个`appName.release`文件，文件配置参考[这里](https://help.aliyun.com/document_detail/52241.html#release-file)，需要仔细阅读一遍，然后将release文件放到git项目中，否则无法正确构建。

以nodejs为例release文件类似于这样：

```shell
# 表示是Node构建
code.language=nodejs
# 需要执行的脚本
build.command=npm --python=/usr/alibaba/install/python-3.5.0/bin/python3 --registry=https://registry.npm.taobao.org install && npm run build:yuntest
# 输出文件、文件夹
build.output=dist
```

​	**注意**：在整个构建过程中你的项目中只能有一个release文件，否则会构建出错。

## 配置环境

​	在【应用】->【环境】->【测试环境】->【部署配置】，这样要填写部署的位置和启停脚本，然后在【资源管理】中关联需要部署的服务器，如果没有服务器则需要添加，还需要安装部署`agent`，这里就不展开说了，跟随引导一步步完成即可。
	![资源](/assets/images/rdc/2.png)

## 执行构建

​	因为选择的开发模式不同，所以部署的按钮位置也会有不同，但在【环境】的页面中可以找到对应环境下的【部署主干】按钮。

​	**Node**或者是**前端项目**构建都需要运行`npm install`命令，虽然已经使用`https://registry.npm.taobao.org`的镜像，但仍然不算快，通常都需要2分钟以上，不知道日后RDC团队会不会做一下缓存优化。

​	部署成功后会在【版本】里看到我们发布的包，但目前似乎不支持下载。

​	**注意：**如果构建过程出错，可能需要手动再运行，具体情况还需要再多体验。

## 回滚

​	在【发布】的页面右上角可以看到【回滚】按钮，我们可以在当中选择构建成功的版本进行回滚，会快速的重新部署。

## 总结

​	关于问题：经过了一下午的试用发现了一些bug，不过好在反馈很快就会得到处理，在这一点上已经完胜CRP团队了，你在使用过程当中如果遇到了问题或是bug可以通过页面右下角的悬浮球来反馈问题，也可以通过钉钉群反馈问题。

​	用户体验：从体验上来讲页面跳转太多，有的时候不好太找到对应的功能，在这一点CRP做的要好一些，当然RDC的功能更加强大，所以难免会有一些复杂。

​	流水线：CRP允许自己随机添加自己需要的任务，在web界面中用户自己配置，RDC则是需要在项目中配置`appName.release`，这样的好处很明显，就是你的配置也可以通过git版本管理起来，只是目前这个配置文件功能还有些弱，而且流程目前是固定的，不能自己添加任务，如果可以像`Dockerfile`一样，可以在`release`文件中自定义配置流程就爽歪歪了。